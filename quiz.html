<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Fair Use Evaluation Tool</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #f0f3fa;
      --card-bg:#ffffff;
      --primary:#4A83F7;
      --accent:#6BCB77;
      --text:#1a1a1a;
      --shadow:0 6px 14px rgba(0,0,0,0.08);
    }

    * { box-sizing: border-box; }

    body{
      font-family: "Inter", sans-serif;
      max-width: 960px;
      margin:auto;
      padding:25px;
      background:var(--bg);
      color:var(--text);
    }

    h1{
      text-align:center;
      font-weight:700;
      font-size:34px;
      margin-bottom:10px;
    }

    .subtitle{
      text-align:center;
      font-size:16px;
      opacity:0.8;
      margin-bottom:24px;
    }

    .intro-card{
      background:var(--card-bg);
      padding:18px 20px;
      border-radius:12px;
      box-shadow:var(--shadow);
      margin-bottom:24px;
      font-size:14px;
      line-height:1.6;
    }

    .intro-card h2{
      margin-top:0;
      font-size:18px;
      margin-bottom:8px;
    }

    .badge{
      display:inline-block;
      padding:2px 8px;
      border-radius:999px;
      font-size:11px;
      background:#e3ebff;
      color:#28408f;
      margin-bottom:6px;
    }

    .question-block{
      margin-bottom:18px;
      padding:16px 18px;
      border-radius:12px;
      background:var(--card-bg);
      box-shadow:var(--shadow);
    }

    .question-label{
      font-size:15px;
      margin-bottom:6px;
    }

    input[type=range]{
      width:100%;
      accent-color:var(--primary);
    }

    .label-row{
      display:flex;
      justify-content:space-between;
      font-size:13px;
      margin-top:6px;
      opacity:.65;
    }

    .score-value{
      font-weight:700;
    }

    button{
      padding:14px 48px;
      font-size:16px;
      border:none;
      border-radius:10px;
      background:var(--primary);
      color:white;
      cursor:pointer;
      display:block;
      margin:26px auto 0 auto;
      transition:.2s;
      box-shadow:var(--shadow);
    }
    button:hover{
      background:#345fd2;
      transform:translateY(-2px);
    }

    #result{
      margin-top:32px;
    }

    .results-card{
      padding:22px 22px 18px 22px;
      background:var(--card-bg);
      border-radius:14px;
      box-shadow:var(--shadow);
      margin-bottom:18px;
    }

    .results-title{
      font-size:20px;
      font-weight:700;
      margin-bottom:10px;
    }

    .results-sub{
      font-size:13px;
      opacity:.8;
      margin-bottom:16px;
    }

    .score-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:4px;
      margin-bottom:4px;
      font-size:15px;
    }

    .score-label{
      font-weight:600;
    }

    .score-number{
      font-weight:700;
    }

    .bar-container{
      width:100%;
      background:#d8dee9;
      border-radius:999px;
      margin:10px 0 2px 0;
      height:16px;
      overflow:hidden;
    }
    .bar{
      height:100%;
      border-radius:999px;
      background: linear-gradient(90deg, #ff5757, #ffcb57, #57ff9a);
      transition:width .6s;
    }

    .overall-description{
      font-size:14px;
      margin-top:10px;
      line-height:1.5;
    }

    .disclaimer{
      font-size:11px;
      opacity:0.7;
      margin-top:8px;
    }

    .factor-block{
      margin-top:18px;
      padding:18px;
      background:var(--card-bg);
      border-radius:12px;
      box-shadow:var(--shadow);
    }
    .factor-title{
      font-size:16px;
      margin-bottom:6px;
      font-weight:600;
    }
    .factor-tagline{
      font-size:12px;
      opacity:.7;
      margin-bottom:10px;
    }
    .factor-text{
      font-size:13px;
      line-height:1.5;
      margin-top:8px;
    }

  </style>
</head>

<body>

  <h1>Fair Use Evaluation Tool</h1>
  <div class="subtitle">
    Answer a few questions to get an educational, non-binding sense of how your use might align with U.S. fair use principles.
  </div>

  <div class="intro-card">
    <div class="badge">What is fair use?</div>
    <h2>A quick, plain-language overview</h2>
    <p>
      Under U.S. copyright law, <b>fair use</b> is a flexible doctrine that sometimes allows you to use someone else’s copyrighted work
      without permission. Courts look at several factors together, rather than applying a strict formula, and different judges can weigh
      those factors differently.
    </p>
    <p>
      This tool walks through the four traditional fair use factors:
      <b>purpose and character of your use</b>, <b>nature of the work</b>,
      <b>amount used</b>, and <b>effect on the market</b>, plus a fifth set of questions about
      <b>other circumstances</b> (such as good faith and how your work might be perceived).
    </p>
    <p style="margin-bottom:4px;">
      Slide each question from <b>1</b> (least supportive of fair use) to <b>9</b> (most supportive). The results are an educational
      heuristic only—they are <b>not legal advice</b> and do not predict what a court would do.
    </p>
  </div>

  <div id="questionContainer"></div>

  <button type="button" onclick="calculateScore()">Evaluate Fair Use</button>

  <div id="result"></div>

  <script>
    // =====================================================
    // CONFIGURATION
    // =====================================================

    // Plain-English question texts (1–25)
    const questionTexts = {
      // Factor 1: Purpose & Character
      1: "How much does your use add new meaning or purpose compared to the original?",
      2: "To what extent would an ordinary viewer see your use as transformative rather than just copying?",
      3: "Does your use mainly comment on, critique, or analyze the original work?",
      4: "How strongly is your use connected to education, research, scholarship, or review?",
      5: "How different is your purpose from the original creator’s purpose for the work?",

      // Factor 2: Nature of the Work
      6: "Is the original work more factual, informational, or documentary than creative or expressive?",
      7: "Is the original material widely available to the public (for example, published or posted)?",
      8: "Does your use focus more on facts, data, or information than on artistic or expressive elements?",
      9: "Would the public benefit from better understanding the material you are using?",
      10:"Is the original work already published rather than an unpublished draft or private work?",

      // Factor 3: Amount & Substantiality
      11:"How small a portion of the original are you using relative to the whole work?",
      12:"Did you avoid taking the most memorable or central “heart” of the original work?",
      13:"Is the amount you used no more than necessary to make your point or achieve your purpose?",
      14:"Did you make a deliberate effort to limit copying instead of taking extra material “just in case”?",
      15:"Could your project still work if you used slightly less of the original work?",

      // Factor 4: Market Effect
      16:"Does your use avoid substituting for or replacing the original work for most audiences?",
      17:"Is it unlikely that your use will reduce sales, licensing opportunities, or views for the original?",
      18:"Does your project target a clearly different audience, context, or use than the original?",
      19:"Is it unlikely that the original creator or publisher will lose meaningful income because of your use?",
      20:"Are people who see your work still likely to seek out or pay for the original if they want it?",

      // Factor 5: Other considerations
      21:"Are you acting in good faith—for example, not trying to pass the work off as entirely your own?",
      22:"Did you avoid adding elements that are misleading, offensive, or likely to be viewed as bad-faith use?",
      23:"Have you clearly distinguished your work from the original creator (for example, through context or labeling)?",
      24:"Have you avoided suggesting or implying that the original creator sponsors or endorses your project?",
      25:"Did you use only what felt genuinely necessary rather than copying out of convenience or habit?"
    };

    // Reverse-scored questions (1..25) if any (e.g., where 9 is worst, 1 is best)
    // Leave empty or adjust as needed.
    const reverseQuestions = [
      // Example: 15, 19
    ];

    // Weights for each question (index 1..25)
    // Subjective: higher = more influence on manual score
    const weights = Array(26).fill(1);

    // Factor 1 (Purpose & Character) – questions 1–5
    weights[1] = 3;
    weights[2] = 3;
    weights[3] = 3;
    weights[4] = 2;
    weights[5] = 2;

    // Factor 2 (Nature of the Work) – 6–10
    weights[6] = 2;
    weights[7] = 1;
    weights[8] = 1;
    weights[9] = 1;
    weights[10] = 2;

    // Factor 3 (Amount & Substantiality) – 11–15
    weights[11] = 2;
    weights[12] = 2;
    weights[13] = 2;
    weights[14] = 2;
    weights[15] = 1;

    // Factor 4 (Market Effect) – 16–20
    weights[16] = 3;
    weights[17] = 3;
    weights[18] = 2;
    weights[19] = 3;
    weights[20] = 3;

    // Factor 5 (Other considerations) – 21–25
    weights[21] = 1;
    weights[22] = 1;
    weights[23] = 2;
    weights[24] = 2;
    weights[25] = 1;

    // Factor groupings (you can change which questions belong to which factor)
    const factorAssignments = {
      purpose: [1,2,3,4,5],
      nature:  [6,7,8,9,10],
      amount:  [11,12,13,14,15],
      market:  [16,17,18,19,20],
      other:   [21,22,23,24,25]
    };

    const factorMeta = {
      purpose: {
        title: "Factor 1 — Purpose & Character of the Use",
        tagline: "How transformative and goal-driven your use is."
      },
      nature: {
        title: "Factor 2 — Nature of the Copyrighted Work",
        tagline: "How factual, published, and information-oriented the source is."
      },
      amount: {
        title: "Factor 3 — Amount & Substantiality",
        tagline: "How much you took and whether you avoided the core of the work."
      },
      market: {
        title: "Factor 4 — Effect on the Market",
        tagline: "Whether your use competes with or harms the original’s market."
      },
      other: {
        title: "Other Fair Use Considerations",
        tagline: "Good faith, clarity, and how your use might be perceived."
      }
    };

    // Per-factor descriptions for low/medium/high
    const factorDescriptions = {
      purpose: {
        low:  "Your answers suggest the purpose and character of your use are close to straightforward copying, with limited transformation or new meaning. This tends to weigh against fair use.",
        med:  "Your use is partly transformative or educational, but also overlaps with the original’s purpose. Courts might see this factor as mixed or borderline.",
        high: "Your answers indicate a strongly transformative, critical, or educational use that clearly adds new meaning or purpose. This factor would generally support a fair use argument."
      },
      nature: {
        low:  "You appear to be using creative, expressive, or unpublished material in ways that give the creator less leeway. This factor leans against fair use.",
        med:  "The work you are using is partly factual or published, but it also has expressive elements. This factor is neutral or mixed.",
        high: "You seem to be using mainly factual, informational, or already published material. This factor tends to favor fair use."
      },
      amount: {
        low:  "You are using a large amount of the work or focusing on its most memorable pieces. This weighs against fair use.",
        med:  "You have limited your use somewhat, but you may still be close to the “heart” of the work or using more than strictly needed. This factor is mixed.",
        high: "You appear to use a relatively small portion, tailored to what is necessary to make your point, while avoiding the central or iconic parts. This favors fair use."
      },
      market: {
        low:  "Your use may substitute for the original or significantly reduce demand for it, which is a major strike against fair use.",
        med:  "It’s not clear whether your use will meaningfully affect the market. There may be some overlap but also some separation in audience or purpose.",
        high: "Your use seems unlikely to replace the original or harm its market, and may even send people back to the original. This factor would typically support a fair use claim."
      },
      other: {
        low:  "Your answers suggest potential concerns about good faith, clarity, or how your use might be perceived (for example, as misleading or offensive). This may nudge a decision away from fair use.",
        med:  "You appear to be acting in reasonably good faith, but there may be some ambiguity in how your use is presented or understood.",
        high: "You seem to be acting in good faith, clearly distinguishing your work from the original and avoiding misleading impressions. This supports a fair use-friendly overall picture."
      }
    };

    // Overall manual score descriptions
    const overallDescriptions = {
      low:  "Based on your answers, your use appears unlikely to qualify as fair use without significant changes. Several key factors lean against fair use, especially transformation and market effect.",
      med:  "Your answers suggest a borderline situation: some factors point toward fair use, while others raise concerns. Legal outcomes in this range are often uncertain and depend heavily on details.",
      high: "Overall, your answers describe a use that aligns well with many fair use principles: transformative purpose, limited use, and modest market impact. While not a guarantee, this pattern is generally fair-use friendly."
    };

    // =====================================================
    // RENDER QUESTIONS
    // =====================================================

    function renderQuestions() {
      const container = document.getElementById("questionContainer");
      for (let i = 1; i <= 25; i++) {
        const block = document.createElement("div");
        block.className = "question-block";
        block.innerHTML = `
          <div class="question-label"><b>Q${i}.</b> ${questionTexts[i]}</div>
          <input type="range" min="1" max="9" value="5" id="q${i}"
                 oninput="document.getElementById('v${i}').innerText=this.value">
          <div class="label-row">
            <span>1 (less supportive)</span>
            <span class="score-value" id="v${i}">5</span>
            <span>9 (more supportive)</span>
          </div>
        `;
        container.appendChild(block);
      }
    }

    renderQuestions();

    // =====================================================
    // SCORING
    // =====================================================

    async function calculateScore() {
      const original = [];
      const normalized = [];

      // collect answers
      for (let i = 1; i <= 25; i++) {
        let val = parseFloat(document.getElementById("q" + i).value);
        if (isNaN(val)) val = 5;
        original.push(val);

        let norm = reverseQuestions.includes(i) ? 10 - val : val;
        normalized.push(norm);
      }

      // manual overall score (0–100)
      let weightedSum = 0;
      let totalWeight = 0;
      for (let i = 1; i <= 25; i++) {
        weightedSum += normalized[i-1] * weights[i];
        totalWeight += weights[i];
      }
      const minPossible = 1 * totalWeight;
      const maxPossible = 9 * totalWeight;
      const manualPercent = ((weightedSum - minPossible) / (maxPossible - minPossible)) * 100;

      // call ML backend (using original slider values)
      let mlPercent = NaN;
      try {
        const response = await fetch("http://127.0.0.1:5000/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ answers: original })
        });
        const mlResult = await response.json();
        mlPercent = mlResult.score * 100;
      } catch (e) {
        // backend not available or error
        mlPercent = NaN;
      }

      // per-factor scores using normalized values
      const factorScores = {};
      for (const key in factorAssignments) {
        const qList = factorAssignments[key];
        let wSum = 0;
        let wTot = 0;
        for (const q of qList) {
          wSum += normalized[q-1] * weights[q];
          wTot += weights[q];
        }
        const fMin = 1 * wTot;
        const fMax = 9 * wTot;
        const p = ((wSum - fMin) / (fMax - fMin)) * 100;
        factorScores[key] = p;
      }

      // choose overall description bucket based on manualPercent
      let overallText;
      if (manualPercent < 33.333) {
        overallText = overallDescriptions.low;
      } else if (manualPercent < 66.666) {
        overallText = overallDescriptions.med;
      } else {
        overallText = overallDescriptions.high;
      }

      // build result HTML
      let html = `
        <div class="results-card">
          <div class="results-title">Overall Fair Use Snapshot</div>
          <div class="results-sub">These scores are educational only and do not constitute legal advice.</div>

          <div class="score-row">
            <div class="score-label">Manual score (based on your answers):</div>
            <div class="score-number">${manualPercent.toFixed(1)}%</div>
          </div>
          <div class="bar-container">
            <div class="bar" style="width:${Math.max(0, Math.min(100, manualPercent))}%;"></div>
          </div>
      `;

      if (!Number.isNaN(mlPercent)) {
        html += `
          <div class="score-row">
            <div class="score-label">AI model score (0–100):</div>
            <div class="score-number">${mlPercent.toFixed(1)}%</div>
          </div>
          <div class="bar-container">
            <div class="bar" style="width:${Math.max(0, Math.min(100, mlPercent))}%;"></div>
          </div>
        `;
      } else {
        html += `
          <div class="score-row">
            <div class="score-label">AI model score:</div>
            <div class="score-number" style="opacity:0.7;">not available (server not running)</div>
          </div>
        `;
      }

      html += `
          <div class="overall-description">${overallText}</div>
          <div class="disclaimer">
            This tool is for teaching and discussion only. Only a court can make a binding fair use determination.
          </div>
        </div>
      `;

      // add factor blocks
      for (const key in factorScores) {
        const p = factorScores[key];
        let desc;
        if (p < 33.333) desc = factorDescriptions[key].low;
        else if (p < 66.666) desc = factorDescriptions[key].med;
        else desc = factorDescriptions[key].high;

        const meta = factorMeta[key];

        html += `
          <div class="factor-block">
            <div class="factor-title">${meta.title}</div>
            <div class="factor-tagline">${meta.tagline}</div>
            <div class="score-row">
              <div class="score-label">Score for this factor:</div>
              <div class="score-number">${p.toFixed(1)}%</div>
            </div>
            <div class="bar-container">
              <div class="bar" style="width:${Math.max(0, Math.min(100, p))}%;"></div>
            </div>
            <div class="factor-text">${desc}</div>
          </div>
        `;
      }

      document.getElementById("result").innerHTML = html;
    }
  </script>

</body>
</html>
